name: ğŸ” ValidaÃ§Ã£o de Scripts

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  validate-scripts:
    name: ğŸ§ª Teste de Scripts
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Ubuntu
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck

      - name: ğŸ§¹ AnÃ¡lise estÃ¡tica com ShellCheck
        run: |
          echo "ğŸ” Analisando scripts bash..."
          find scripts/ -name "*.sh" -type f -exec shellcheck {} \;

      - name: âœ… Teste de carregamento dos scripts
        run: |
          echo "ğŸ§ª Testando carregamento do sistema core..."
          bash -n scripts/core/bootstrap.sh
          bash -n scripts/core/colors.sh
          bash -n scripts/core/utils.sh
          bash -n scripts/setup.sh

      - name: ğŸ” Validar configuraÃ§Ãµes
        run: |
          echo "ğŸ”§ Verificando arquivo .env.example..."
          test -f .env.example
          echo "âœ… Arquivo .env.example existe"

          echo "ğŸ“‹ Verificando se hÃ¡ configuraÃ§Ãµes obrigatÃ³rias..."
          grep -q "DEV_USER_NAME" .env.example
          grep -q "DEV_USER_EMAIL" .env.example
          echo "âœ… ConfiguraÃ§Ãµes obrigatÃ³rias presentes"

      - name: ğŸ›¡ï¸ Verificar seguranÃ§a bÃ¡sica
        run: |
          echo "ğŸ”’ Verificando se nÃ£o hÃ¡ informaÃ§Ãµes sensÃ­veis commitadas..."
          ! grep -r "password\|secret\|token" --include="*.sh" --include="*.env*" scripts/ || true
          echo "âœ… Nenhuma informaÃ§Ã£o sensÃ­vel encontrada"

  validate-documentation:
    name: ğŸ“š ValidaÃ§Ã£o da DocumentaÃ§Ã£o
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ” Verificar documentaÃ§Ã£o
        run: |
          echo "ğŸ“– Verificando arquivos de documentaÃ§Ã£o..."
          test -f README.md
          test -f docs/TERMINAL_SETUP.md
          test -f docs/VSCODE_SETUP.md
          test -f CHANGELOG.md
          echo "âœ… DocumentaÃ§Ã£o bÃ¡sica presente"

      - name: ğŸ”— Verificar links no README
        run: |
          echo "ğŸ”— Verificando estrutura do README..."
          grep -q "Quick Start" README.md
          grep -q "Project Structure" README.md || grep -q "Estrutura do Projeto" README.md
          echo "âœ… README bem estruturado"

  powershell-validation:
    name: ğŸªŸ ValidaÃ§Ã£o PowerShell
    runs-on: windows-latest

    steps:
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸ” Testar sintaxe PowerShell
        shell: pwsh
        run: |
          Write-Host "ğŸ§ª Testando scripts PowerShell..."
          Get-ChildItem -Path "scripts/tools/*.ps1" | ForEach-Object {
            Write-Host "Testando: $($_.Name)"
            $null = [System.Management.Automation.PSParser]::Tokenize((Get-Content $_.FullName -Raw), [ref]$null)
          }
          Write-Host "âœ… Sintaxe PowerShell vÃ¡lida"
